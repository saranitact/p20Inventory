
pipeline {
  agent{
     node {
       label 'master'
     }
    }
/*     tools { 
        maven MAVEN_HOME 
    }*/
 environment{
        JENKINS_HOME= "E:\\Users\\SARAN\\workspace\\p20Inventory"
       // M2_HOME=%Maven_HOME%
    }
    stages {
       /*  stage("Git Checkout"){
           steps{
                git credentialsId: 'github', url: 'https://github.com/saranitact/p20Inventory'
            }
        }*/
        stage("Maven Build"){
            steps{
                bat 'echo "M2_HOME: %Maven_HOME%"'
                 bat 'echo "JENKINS_HOME: %JENKINS_HOME%"'
                 bat 'mvn clean test'
                echo 'Compile and Unit Test Completed'
            }
        }
         stage('Static Analysis'){
            steps{
                   bat 'xcopy E:\\Users\\SARAN\\workspace\\p20Inventory %WORKSPACE%\\ /s /y'
                   withSonarQubeEnv('SonarQube_Home') {
                    bat 'mvn sonar:sonar -Dsonar.host.url=http://localhost:9000 -Dsonar.login=94a5afcdac3bcf731bfa5467a0169fe806b31601' 
                    echo 'Static Analysis Completed'
                 }
              }
         }
          stage("Quality Gate"){
            steps{
              timeout(time: 5, unit: 'MINUTES') {
              def qg= waitForQualityGate()
               /* if (qg.status!= 'OK'){
                  error "Pipeline aborted due to quality gate failure: ${qg.status}"
                }*/
             }         
              echo 'Quality Gate Passed'
           }
        }    
      } //stages
  } //pipeline
